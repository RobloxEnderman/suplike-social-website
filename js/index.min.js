const _user_id=sessionStorage.getItem("user")||"",_user_name=sessionStorage.getItem("name")||"";async function mainload(e="./inc/post.inc.php?user="){let t=0;function i(e){e.profile_picture||(e.profile_picture="default.jpg")}function n(e){e.forEach((async e=>{i(e),await $("#main-post").append(render(e))}))}return $("#image_post").on("change",(function(e){e.preventDefault();const t=URL.createObjectURL(event.target.files[0]);$("#type").val("img"),$("#imagedisp").attr("src",t)})),await async function(e){const s=await $.get(`${e}${_user_id}`);if(Array.isArray(s))n(s);else{if("error"===s?.type)return;s?.data?(n(s.data),t=s.data.length):(i(a=s),$("#main-post").append(render(a)))}var a;addClick(),add_lightbox()}(e),t}function render(e){let t=e.image_text.replace(/\r\n/g,"<br>");if(post_text_html=t.replace(/\n/g,"<br>"),e.image_text=post_text_html,e.liked?l="fas like":l="far",!0===e.user?_user={name:_user_name,id:_user_id}:_user=e.user,"img"==e.type||"txt"==e.type)return`\n    <div class="post-div shadow">\n    ${""!=e.repost?`\n      <div class="d-flex justify-content-left py-1 px-3">\n      <a\n      href="post.php?id=${e.repost}"\n    >\n      <i class="fas fa-retweet"></i>\n       <span class="mx-2">repost</span></a>\n      </div>`:""}\n      <div class="d-flex justify-content-between p-2 px-3">\n        <div class="d-flex flex-row align-items-center">\n            <a href="profile.php?id=${_user.id}">\n          <img\n            src="img/${e.profile_picture}"\n            width="36px"\n            height="36px"\n            class="rounded-circle"\n          />\n            </a>\n          <div class="d-flex flex-column ml-2">\n            <a href="profile.php?id=${_user.id}">\n              <small class="text-left text-muted text-primary usn py-2 ml-1">@${_user.name}\n              ${e.admin?"<i class='fa fa-user-shield text-muted  mx-1'></i>":""}  \n              ${e.bot?"<i class='fa fa-robot text-muted  mx-1'></i>":""}</small>\n            </a>\n          </div>\n        </div>\n\n        <div class="d-flex flex-row mt-1 ellipsis">\n          <small class="mr-2 text-muted">${e.date_posted}</small>\n          <a\n            class="dropdown-toggle cob"\n            href="#"\n            role="button"\n            id="dropdownMenuLink"\n            data-toggle="dropdown"\n            aria-haspopup="true"\n            aria-expanded="false"\n          >\n            <i class="fa fa-ellipsis-h"></i>\n          </a>\n          <div\n            class="dropdown-menu cob dropdown-menu-right shadow animated--fade-in bga"\n            aria-labelledby="dropdownMenuLink"\n            style=""\n          >\n            <div class="dropdown-header">Actions:</div>\n            <a\n              class="dropdown-item mj-actions post-page"\n              href="post.php?id=${e.post_id}"\n            >\n              <i class="fa fa-eye fa-fw"></i> View Post\n            </a>\n            ${_user.name==_user_name?`<a class="dropdown-item delete mj-actions" href="inc/post.inc.php?del_post=${e.post_id}">\n                <i class="fa fa-trash fa-fw"></i> Delete Post\n              </a>`:""}\n            <a\n              class="dropdown-item mj-actions share"\n              id="${e.post_id}"\n              href="#share"\n            >\n              <i class="fa fa-share-alt fa-fw"></i> Share\n            </a>\n            \n            <a class="dropdown-item mj-actions report" id="${e.id}" href="#report">\n              <i class="fa fa-flag fa-fw"></i> Report\n            </a>\n            <div class="dropdown-divider"></div>\n            <a class="dropdown-item" href="profile.php?id=${_user.id}">visit profile</a>\n          </div>\n        </div>\n      </div>\n      ${"img"===e.type?`\n        <div class="lazyload">\n          \x3c!-- <a href="./img/${e.image}" data-lightbox="${e.post_id}" data-title="${e.image_text}" data-image-alt="image post">\n            <div class="post-body" style="background-image: url(./img/${e.image});"></div>\n          </a> --\x3e\n        </div>\n        <p class="lone co p-1">${e.image_text}</p>\n        `:`\n        <div class="px-1 py-3">\n          <p class="lone co">${e.image_text}</p>\n        </div>\n        `}\n      <div class="social-opt">\n        <div class="row social-act co w-100">\n          <div class="col-3 flex icon">\n            <i title="like" tabindex="0" role="button" id="${e.id}" class="${l} mr-1  this-click fa-heart"></i>\n            <small class="${e.id}">${e.post_likes<=0?"":e.post_likes}</small>\n          </div>\n          <div class="col-3 flex icon">\n            <a href="./comment.php?id=${e.post_id}">\n              <i title="comment" id="comment" class="fas mr-1  fa-comment comment"></i>\n            </a>\n            <small>${e.comments<=0?"":e.comments}</small>\n          </div>\n          <div class="col-3 icon">\n            <a href="#share" class="share" id="${e.post_id}">\n              <i title="share this post" class="fas fa-share"></i>\n            </a>\n          </div>\n          <div class="col-3 icon">\n            <a href="inc/repost.inc.php?id=${e.post_id}" class="repost">\n              <i title="repost this post" class="fas fa-retweet"></i>\n            </a>\n          </div>\n        </div>\n      </div>\n    </div>`}function addClick(){$(".this-click").click((function(e){const t=`./inc/like.inc.php?user=${_user_id}&id=${this.id}`,i=`.${this.id}`,n=Number($(i).text()),s=this.classList.contains("fas")?-1:1;$(i).text(n+s);const a=1===s?"true":"false",l=1===s?"fas fa-heart  mr-1 icon-click like":"far fa-heart  mr-1 icon-click like";$(this).attr("class",l),$.get(`${t}&like=${n+s}&key=${a}`,(function(e){}))})),$(".share").click((async function(e){e.preventDefault;const t=window.location.pathname.split("/");t[t.length-1]&&t.pop();let i=`${t.join("/")}/post.php?id=${this.id}`;i=window.location.origin+i;const n={url:i};try{await navigator.share(n),$.post("./inc/share.inc.php",{id:_user_id})}catch(e){}})),$(".report").click((function(e){e.preventDefault,$.post("./inc/report.inc.php",{id:this.id},(function(e){alert(e)}))})),$(".tocome").click((function(){alert("I am still working on this...")})),$(".lazyload").lazyload()}async function profile_request(e){const t=`./inc/profile.inc.php?id=${e}&user=${_user_id}`,i=await fetch(t),n=await i.json();if(n.user){const{usersFirstname:e,usersSecondname:t,uidusers:i,chat_auth:s,following:a,followers:l,no_posts:o,bio:r,profile_picture:c,posts:p}=n.user,d=e?`${e} ${t}`:"";$("#profile-name").text(d),$(".userName").text(`@${i}`),$(".message-btn").attr("href",`message.php?id=${s}`),$("#following").text(a),$("#followers").text(l),$("#posts").text(o),$(".bio").html(r),$(".profile-pic").attr("src",null!==c?`img/${c}`:"img/default.jpg"),$(".btn").toggle(n!==i),follow(),p&&(await Promise.all(p.map((async e=>{e.profile_picture||(e.profile_picture="default.jpg"),await $("#main-post").append(await render(e))}))),addClick())}else $(".bio").text("an unknown user"),$(".btn").hide()}function post_request(e){url="./inc/post.inc.php?id="+e,$.get(url,(function(e){e.profile_picture=e.user.profile_picture,e.profile_picture||(e.profile_picture="img/default.jpg"),$("#main-post").append(render(e)),addClick()}))}function get_popular_users(){$.get("./inc/search.inc.php?type=users&query",(function(e){"success"==e.type?(e.data.forEach((e=>{let t=e.following?"following":"follow";$("#popular-users").append(`\n        <li class="text-left  align-items-center p-2 border-0  justify-content-between"\n        style='display: flex;'>\n        <a href="profile.php?id=${e.token}">\n        <span class='link co border-0'>@${e.uidusers}</span>\n         </a>\n        <button id='${e.token}' class=" bg p-1 text-center text-white  border-0  outline-0 follower-btn follow-btn p-0" \n        style='outline: none; border-radius: 5px; width: 40%; position: relative; overflow: hidden'>\n        <span class="small">${t}</span>\n        </button>\n    </li>`)})),follow(_user_id)):$("#popular-users").append("<div class='text-center w-full'>Not logged in</div>")}))}function get_popular_tags(){$.get("./inc/search.inc.php?type=tags&query",(function(e){"success"==e.type?e.data.forEach((e=>{$("#popular-tags").append(`\n        <a href="topics.php?t=${e.name}" class=" border-0 page-link tab_bg link">\n          <li class="text-left align-items-center p-2 border-0  justify-content-between"\n          style='display: flex;'>\n            <span class='co border-0'>#${e.name}</span>\n            <span class="small mx-2">view</span>    \n          </li>\n        </a>\n    `)})):$("#popular-users").append("<div class='text-center w-full'>Not logged in</div>")}))}function follow(e){e=e||_user_id,$(".follow-btn").click((function(){var t=this.id||profile,i="follow"===$(this).children("span").text().trim(),n=$("#followers"),s=parseInt(n.text());i?($(this).children("span").text("following"),$(this).children("i").attr("class","fas fa-user  ml-2 no-h  text-white"),s++):($(this).children("span").text("follow"),$(this).children("i").attr("class","fas fa-user-plus ml-2 no-h  text-white "),s--),n.text(s);var a=`./inc/follow.inc.php?user=${e}&following=${t}&key=${i}`;$.get(a,(function(e){"error"==e.type&&alert(e.message||e.msg)}))}))}function add_lightbox(){$("body").append('<script defer src="./lib/lightbox/js/lightbox.min.js"><\/script>  ')}function active_page(e){$(`.${["purple","pink","yellow","teal","blue"][e]}`).addClass("active")}$("body").on("keydown",(function(e){if(13===e.keyCode||32===e.keyCode){var t=$(e.target);"0"===t.attr("tabindex")&&(t.click(),e.preventDefault())}})),$("#logout").click((function(){sessionStorage.clear()}));