const _user_id=sessionStorage.getItem("user"),_user_name=sessionStorage.getItem("name");function mainload(){function getUsers(){$.get("./inc/post.inc.php?user="+_user_id,(function(posts){posts instanceof Array?(posts.forEach(post=>{post.profile_picture||(post.profile_picture="default.jpg"),$("#main-post").append(render(post))}),addClick(),add_lightbox()):$("#main-post").append("<div class='post-div shadow no-user' class='text-center'><h4> you need to follow someone in order to view post on your feed</h4>\n               <p> go to <a href=\"search.php?q=e\"><b>search</b></a> and look for a user to follow</p>  \n            </div>")}))}$("#image_post").on("change",(function(e){e.preventDefault();var m=URL.createObjectURL(event.target.files[0]);$("#type").val("img"),$("#imagedisp").attr("src",m)})),getUsers()}function render(post){let post_text,post_text_html=post.image_text.replace(/\n/g," ").replace(/\r/g," ");return post.image_text=post_text_html,post.liked?l="fas like":l="far",!0===post.user?_user={name:_user_name,id:_user_id}:_user=post.user,"img"==post.type?`\n      <div class="post-div shadow">\n      <div class="d-flex justify-content-between p-2 px-3">\n      <div class="d-flex flex-row align-items-center">\n        <img\n          src="img/${post.profile_picture}"\n          width="36"\n          class="rounded-circle"\n        />\n        <div class="d-flex flex-column ml-2">\n          <a href="profile.php?id=${_user.id}">\n            <small class="text-left text-muted text-primary usn py-2 ml-1">@${_user.name}</small>\n          </a>\n        </div>\n      </div>\n      <div class="d-flex flex-row mt-1 ellipsis">\n        <small class="mr-2">${post.date_posted}</small>\n        <a\n          class="dropdown-toggle co"\n          href="#"\n          role="button"\n          id="dropdownMenuLink"\n          data-toggle="dropdown"\n          aria-haspopup="true"\n          aria-expanded="false"\n        >\n          <i class="fa fa-ellipsis-h"></i\n        ></a>\n        <div\n        class="dropdown-menu cob dropdown-menu-right shadow animated--fade-in bga"\n        aria-labelledby="dropdownMenuLink"\n        style=""\n      >\n        <div class="dropdown-header">Actions:</div>\n        <a\n          class="dropdown-item mj-actions post-page"\n          href="post.php?id=${post.post_id}"\n        >\n          <i class="fa fa-eye fa-fw"></i> View Post\n        </a>\n        <a class="dropdown-item delete mj-actions" href="inc/post.inc.php?del_post=${post.post_id}">\n          <i class="fa fa-trash fa-fw"></i> Delete Post\n        </a>\n        <a\n          class="dropdown-item mj-actions share"\n          id="${post.post_id}"\n          href="#share"\n        >\n          <i class="fa fa-share-alt fa-fw"></i> Share\n        </a>\n        <a class="dropdown-item mj-actions report" id="${post.id}" href="#report">\n          <i class="fa fa-flag fa-fw"></i> Report\n        </a>\n        <a\n          class="dropdown-item mj-actions  embed tocome"\n          id="${post.post_id}"\n          href="#embed"\n        >\n          <i class="fa fa-code fa-fw"></i> Embed\n        </a>\n        <div class="dropdown-divider"></div>\n        <a class="dropdown-item" href="profile.php?id=${post.post_id}"\n          >visit profile</a\n        >\n      </div>\n    </div>\n    </div>\n           <div class="lazyload">\n           \x3c!-- <a href="./img/${post.image}"  data-lightbox data-image-alt="image post">     \n                   <div class="post-body" style="background-image: url(./img/${post.image});">\n                    </div> \n             </a> --\x3e \n             </div>\n          \n              <p class="lone co p-1">${post.image_text}</p>\n              <div class="social-opt">\n              <div class="row social-act co w-100">\n                <div class="col-3 flex icon">\n                  <i title="like" id="${post.id}" class="${l} mr-1  this-click fa-heart"\n                    ></i\n                  >\n                   <small class="${post.id}">${post.post_likes<=0?"":post.post_likes}</small>\n                </div>\n                <div class="col-3 flex icon">\n                  <a href="./comment.php?id=${post.post_id}">\n                    <i title="comment" id="comment" class="fas mr-1  fa-comment comment "\n                      ></i\n                    ></a>\n                   <small>${post.comments<=0?"":post.comments}</small>\n                  \n                </div>\n                <div class="col-3 icon">\n                  <a\n                    href="#share"\n                    class="share"\n                    id="${post.id}"\n                    ><i title="share this post" class="fas fa-share"></i\n                  ></a>\n                </div>\n                <div class="col-3 icon">\n                  <a\n                    href="inc/repost.inc.php?id=${post.post_id}"\n                    class="repost"\n                    ><i title="repost this post" class="fas fa-retweet"></i\n                  ></a>\n                  </div>\n              </div>\n            </div>\n        </div>\n                 \n \n         `:`\n        <div class="post-div shadow">\n        <div class="d-flex justify-content-between p-2 px-3">\n        <div class="d-flex flex-row align-items-center">\n          <img\n            src="img/${post.profile_picture}"\n            width="36"\n            class="rounded-circle"\n          />\n          <div class="d-flex flex-column ml-2">\n            <a href="profile.php?id=${_user.id}">\n              <small class="text-left text-muted text-primary usn py-2 ml-1">@${_user.name}</small>\n            </a>\n          </div>\n        </div>\n        <div class="d-flex flex-row mt-1 ellipsis">\n          <small class="mr-2">${post.date_posted}</small>\n          <a\n            class="dropdown-toggle cob"\n            href="#"\n            role="button"\n            id="dropdownMenuLink"\n            data-toggle="dropdown"\n            aria-haspopup="true"\n            aria-expanded="false"\n          >\n            <i class="fa fa-ellipsis-h"></i\n          ></a>\n          <div\n          class="dropdown-menu cob dropdown-menu-right shadow animated--fade-in bga"\n          aria-labelledby="dropdownMenuLink"\n          style=""\n        >\n          <div class="dropdown-header">Actions:</div>\n          <a\n            class="dropdown-item mj-actions post-page"\n            href="post.php?id=${post.post_id}"\n          >\n            <i class="fa fa-eye fa-fw"></i> View Post\n          </a>\n          <a class="dropdown-item delete mj-actions" href="inc/post.inc.php?del_post=${post.post_id}">\n            <i class="fa fa-trash fa-fw"></i> Delete Post\n          </a>\n          <a\n            class="dropdown-item mj-actions share"\n            id="${post.post_id}"\n            href="#share"\n          >\n            <i class="fa fa-share-alt fa-fw"></i> Share\n          </a>\n          <a class="dropdown-item mj-actions report" id="${post.id}" href="#report">\n            <i class="fa fa-flag fa-fw"></i> Report\n          </a>\n          <a\n            class="dropdown-item mj-actions  embed tocome"\n            id="${post.post_id}"\n            href="#embed"\n          >\n            <i class="fa fa-code fa-fw"></i> Embed\n          </a>\n          <div class="dropdown-divider"></div>\n          <a class="dropdown-item" href="profile.php?id=${post.post_id}"\n            >visit profile</a\n          >\n        </div>\n      </div>\n      </div>\n            <div class="px-1 py-3">\n            <p class="lone co px-1">${post.image_text}</p>\n            </div>\n            <div class="social-opt">\n            <div class="row social-act co w-100">\n              <div class="col-3 flex icon">\n                <i title="like" id="${post.id}" class="${l} mr-1  this-click fa-heart"\n                  ></i\n                >\n                 <small class="${post.id}">${post.post_likes<=0?"":post.post_likes}</small>\n              </div>\n              <div class="col-3 flex icon">\n                <a href="./comment.php?id=${post.post_id}">\n                  <i title="comment" id="comment" class="fas mr-1  fa-comment comment "\n                    ></i\n                  ></a>\n                 <small>${post.comments<=0?"":post.comments}</small>\n                \n              </div>\n              <div class="col-3 icon">\n                <a\n                  href="#share"\n                  class="share"\n                  id="${post.post_id}"\n                  ><i title="share this post" class="fas fa-share"></i\n                ></a>\n              </div>\n              <div class="col-3 icon">\n                <a\n                  href="inc/repost.inc.php?id=${post.post_id}"\n                  class="repost"\n                  ><i title="repost this post" class="fas fa-retweet"></i\n                ></a>\n                </div>\n            </div>\n          </div>\n        </div>\n  `}function addClick(){$(".this-click").click((function(like){let url=`./inc/like.inc.php?user=${_user_id}&id=${this.id}`;if(this.classList.contains("fas")){let cl=`.${this.id}`,likes=$(cl).text();likes--,$(cl).text(likes),$(this).attr("class","far fa-heart  mr-1 icon-click like"),url=url+"&like="+likes+"&key=false",$.get(url,(function(response){}))}else{let cl=`.${this.id}`,likes=$(cl).text();likes++,$(cl).text(likes),url=url+"&like="+likes+"&key=true",$(this).attr("class","fas fa-heart  mr-1 icon-click like"),$.get(url,(function(response){}))}})),$(".share").click((async function(e){e.preventDefault;let $a=window.location.pathname.split("/");$a.slice(-1)[0]&&$a.pop();let url=`${$a.join("/")}/post.php?id=${this.id}`;url=window.location.origin+url;const shareData={url:url};try{await navigator.share(shareData),$.post("./inc/share.inc.php",{id:_user_id})}catch(err){}})),$(".report").click((function(e){e.preventDefault,$.post("./inc/report.inc.php",{id:this.id},(function(data){alert(data)}))})),$(".tocome").click((function(){alert("I am still working on this...")})),$(".lazyload").lazyload()}function profile_request(profile){url="./inc/profile.inc.php?id="+profile+"&user="+_user_id,$.get(url,(function(user){user.user?($("#profile-name").text(user.user.usersFirstname+" "+user.user.usersSecondname),$(".userName").text("@"+user.user.uidusers),$(".message-btn").attr("href","message.php?id="+user.user.chat_auth),$("#following").text(user.user.following),$("#followers").text(user.user.followers),$("#posts").text(user.user.no_posts),$(".bio").html(user.user.bio),null!==user.user.profile_picture?$(".profile-pic").attr("src","img/"+user.user.profile_picture):$(".profile-pic").attr("src","img/default.jpg"),user==user.user.uidusers&&$(".btn").hide(),follow(),user.posts&&(user.posts.forEach(async post=>{post.profile_picture||(post.profile_picture="default.jpg"),await $("#main-post").append(render(post))}),addClick())):($(".bio").text("an unknown user"),$(".btn").hide())}))}function post_request(profile){url="./inc/post.inc.php?id="+profile,$.get(url,(function(post){post.profile_picture=post.user.profile_picture,post.profile_picture||(post.profile_picture="img/default.jpg"),$("#main-post").append(render(post)),addClick()}))}function report(){}function follow(user){user=user||_user_id,$(".follow-btn").click((function(){var key;switch(profile=this.id||profile,$(this).children("span").text()){case"follow":key="true",$(this).children("span").text("following"),$(this).children("i").attr("class","fas fa-user  ml-2 no-h");var following=parseInt($("#following").text());following++,$("#following").text(following);break;default:key="false",$(this).children("span").text("follow"),$(this).children("i").attr("class","fas fa-user-plus ml-2 no-h");var following=parseInt($("#following").text());following--,$("#following").text(following)}url="./inc/follow.inc.php?user="+user+"&following="+profile+"&key="+key,$.get(url,(function(follow){"error"==follow.type&&alert(follow.msg)}))}))}function add_lightbox(){$("body").append('<script defer src="./lib/lightbox/js/lightbox.min.js"><\/script>  ')}function active_page(co){let colors,active;$(`.${["purple","pink","yellow","teal","blue"][co]}`).addClass("active")}$("#logout").click((function(){sessionStorage.clear()}));